<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é˜¿æ°AIå¼•æ“é«˜é€Ÿæ™ºèƒ½ä¸‹è½½å™¨</title>
  <!-- æ›¿æ¢æ‰åŸæ¥çš„ tailwind.min.js å¼•ç”¨1 -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- å¼•å…¥Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
  
  <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'tech-blue': '#0f172a',
            'tech-dark': '#020617',
            'tech-accent': '#06b6d4',
            'tech-light': '#22d3ee',
            'tech-purple': '#7c3aed',
          },
          fontFamily: {
            'mono': ['JetBrains Mono', 'Consolas', 'Monaco', 'monospace'],
            'tech': ['Orbitron', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow-glow {
        text-shadow: 0 0 10px theme('colors.tech-accent'), 0 0 20px theme('colors.tech-accent/70');
      }
      .border-glow {
        box-shadow: 0 0 5px theme('colors.tech-accent'), 0 0 10px theme('colors.tech-accent/50');
      }
      .pulse-glow {
        animation: pulse 2s infinite;
      }
      .terminal-cursor {
        animation: blink 1s step-end infinite;
      }
      .grid-pattern {
        background-image: 
          linear-gradient(rgba(6, 182, 212, 0.1) 1px, transparent 1px),
          linear-gradient(90deg, rgba(6, 182, 212, 0.1) 1px, transparent 1px);
        background-size: 20px 20px;
      }
      .no-scroll {
        overflow: hidden !important;
        height: 100vh !important;
      }
      .modal-glow {
        box-shadow: 0 0 15px theme('colors.tech-accent/50'), 0 0 30px theme('colors.tech-accent/30');
      }
    }
    
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 5px theme('colors.tech-accent'), 0 0 10px theme('colors.tech-accent/50'); }
      50% { box-shadow: 0 0 10px theme('colors.tech-accent'), 0 0 20px theme('colors.tech-accent/70'); }
    }
    
    @keyframes blink {
      from, to { opacity: 1; }
      50% { opacity: 0; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    /* èŠ‚ç‚¹ä¸‹è½½æŒ‰é’®æ ·å¼ */
    .node-download-btn {
        position: relative; /* ç›¸å¯¹å®šä½ */
        min-height: 70px; /* æœ€å°é«˜åº¦ */
        padding: 0.75rem 1rem; /* å†…è¾¹è· */
    }

    /* èŠ‚ç‚¹æŒ‰é’®å†…å®¹å®¹å™¨ */
    .node-btn-content {
        display: flex; /* å¼¹æ€§å¸ƒå±€ */
        flex-direction: column; /* å‚ç›´æ’åˆ— */
        align-items: center; /* æ°´å¹³å±…ä¸­ */
        gap: 0.375rem; /* å…ƒç´ é—´è· */
        width: 100%; /* å®½åº¦100% */
    }

    /* èŠ‚ç‚¹åç§°æ ·å¼ */
    .node-name {
        font-size: 0.9375rem; /* å­—ä½“å¤§å° */
        font-weight: 500; /* å­—ä½“ç²—ç»† */
        white-space: nowrap; /* ä¸æ¢è¡Œ */
    }

    /* èŠ‚ç‚¹é€Ÿåº¦ä¿¡æ¯å®¹å™¨ */
    .node-speed {
        display: flex; /* å¼¹æ€§å¸ƒå±€ */
        align-items: center; /* å‚ç›´å±…ä¸­ */
        gap: 0.25rem; /* å…ƒç´ é—´è· */
    }

    /* é€Ÿåº¦æ ‡ç­¾æ ·å¼ */
    .speed-badge {
        font-size: 0.75rem; /* å­—ä½“å¤§å° */
        font-weight: 500; /* å­—ä½“ç²—ç»† */
        padding: 0.25rem 0.5rem; /* å†…è¾¹è· */
        border-radius: 12px; /* åœ†è§’ */
    }

    /* ä¼˜ç§€é€Ÿåº¦æ ‡ç­¾æ ·å¼ */
    .speed-badge.badge-success {
        background-color: #10b981; /* èƒŒæ™¯è‰² */
        color: white; /* æ–‡å­—é¢œè‰² */
    }

    /* è‰¯å¥½é€Ÿåº¦æ ‡ç­¾æ ·å¼ */
    .speed-badge.badge-primary {
        background-color: #2563eb; /* èƒŒæ™¯è‰² */
        color: white; /* æ–‡å­—é¢œè‰² */
    }

    /* ä¸€èˆ¬é€Ÿåº¦æ ‡ç­¾æ ·å¼ */
    .speed-badge.badge-warning {
        background-color: #f59e0b; /* èƒŒæ™¯è‰² */
        color: white; /* æ–‡å­—é¢œè‰² */
    }

    /* æ…¢é€Ÿæ ‡ç­¾æ ·å¼ */
    .speed-badge.badge-secondary {
        background-color: #6b7280; /* èƒŒæ™¯è‰² */
        color: white; /* æ–‡å­—é¢œè‰² */
    }

    /* æµ‹é€Ÿä¸­æ ‡ç­¾æ ·å¼ */
    .speed-badge.badge-info {
        background-color: #3b82f6; /* èƒŒæ™¯è‰² */
        color: white; /* æ–‡å­—é¢œè‰² */
    }

    /* æ¨èæ ‡ç­¾æ ·å¼ */
    .recommended-badge {
        background-color: #10b981; /* èƒŒæ™¯è‰² */
        color: white; /* æ–‡å­—é¢œè‰² */
        font-size: 0.7rem; /* å­—ä½“å¤§å° */
        padding: 0.15rem 0.4rem; /* å†…è¾¹è· */
        border-radius: 10px; /* åœ†è§’ */
        margin-left: 0.25rem; /* å·¦è¾¹è· */
    }

    /* æµ‹é€Ÿä¸­çš„åŠ è½½åŠ¨ç”» */
    .speed-badge.testing {
        animation: pulse 1.5s ease-in-out infinite; /* è„‰å†²åŠ¨ç”» */
    }

    /* è„‰å†²åŠ¨ç”»å…³é”®å¸§ */
    @keyframes pulse {
        0%, 100% { opacity: 1; } /* å¼€å§‹å’Œç»“æŸé€æ˜åº¦ */
        50% { opacity: 0.5; } /* ä¸­é—´é€æ˜åº¦ */
    }

    /* å“åº”å¼è°ƒæ•´ - ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
        .node-download-btn {
            min-height: 65px; /* ç§»åŠ¨ç«¯æœ€å°é«˜åº¦ */
        }

        .node-name {
            font-size: 0.875rem; /* ç§»åŠ¨ç«¯å­—ä½“å¤§å° */
        }

        .speed-badge {
            font-size: 0.7rem; /* ç§»åŠ¨ç«¯å­—ä½“å¤§å° */
        }
    }
  </style>
  
  <!-- å¼•å…¥å­—ä½“ -->
  <link href="https://fonts.font.im/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.font.im/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>

<body class="bg-tech-dark text-gray-300 font-mono min-h-screen grid-pattern relative overflow-x-hidden">
  <!-- é¡µé¢å®¹å™¨ -->
  <div class="container mx-auto px-4 py-8 relative z-20">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <header class="mb-10 text-center relative">
      <div id="title-container" class="relative h-24 flex items-center justify-center overflow-hidden">
        <h1 id="main-title" class="text-[clamp(1.5rem,5vw,3rem)] font-tech font-bold text-tech-accent text-shadow-glow tracking-wider">
          ğŸš€ é˜¿æ°AIå¼•æ“é«˜é€Ÿæ™ºèƒ½ä¸‹è½½å™¨ ğŸš€
        </h1>
        <div class="absolute inset-0 bg-gradient-to-b from-tech-dark/0 via-tech-accent/10 to-tech-dark/0 opacity-70"></div>
      </div>
      
      <!-- åŠ è½½åŠ¨ç”» -->
      <div id="loading-animation" class="flex justify-center items-center h-16 mb-4">
        <div class="w-1 h-8 bg-tech-accent rounded-full mr-2 pulse-glow"></div>
        <div class="w-1 h-12 bg-tech-accent rounded-full mr-2 pulse-glow" style="animation-delay: 0.2s"></div>
        <div class="w-1 h-10 bg-tech-accent rounded-full mr-2 pulse-glow" style="animation-delay: 0.4s"></div>
        <div class="w-1 h-14 bg-tech-accent rounded-full pulse-glow" style="animation-delay: 0.6s"></div>
      </div>
      
      <!-- çŠ¶æ€ä¿¡æ¯ -->
      <div id="status-info" class="text-sm text-gray-400 mt-2 min-h-[2rem]">
        <span>åˆå§‹åŒ–ç³»ç»Ÿ...</span><span class="terminal-cursor">|</span>
      </div>
    </header>
    
    <!-- æˆæƒçŠ¶æ€åŒºåŸŸ -->
    <div id="auth-status" class="mb-8 p-4 rounded-lg bg-tech-blue/50 border border-tech-accent/30">
      <div class="flex items-center">
        <i id="auth-icon" class="fa fa-circle-o-notch fa-spin text-tech-accent mr-3 text-xl"></i>
        <div id="auth-message" class="flex-1">æ­£åœ¨éªŒè¯æˆæƒ...</div>
        <div id="file-info" class="text-right text-sm text-gray-400">
          <div>æ–‡ä»¶å: <span id="filename">-</span></div>
          <div>æ›´æ–°æ—¶é—´: <span id="update-time">-</span></div>
        </div>
      </div>
    </div>
    
    <!-- æµ‹é€ŸåŒºåŸŸ -->
    <div id="speed-test-section" class="mb-8">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-tech text-tech-light">ğŸ“¡ çº¿è·¯æµ‹é€Ÿ</h2>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#downloadModal">
            æ‰“å¼€ä¸‹è½½æ¨¡æ€æ¡†
        </button>
      </div>
      
      <!-- ç»ˆç«¯è¾“å‡ºåŒºåŸŸ -->
      <div id="terminal-output" class="bg-tech-blue/80 border border-tech-accent/30 rounded-lg p-4 h-40 overflow-y-auto mb-6 text-sm font-mono leading-relaxed">
        <div class="text-gray-400">=== ç³»ç»Ÿç»ˆç«¯æ—¥å¿— ===</div>
        <div id="terminal-logs" class="mt-2 space-y-1">
          <div class="animate-fade-in"><span class="text-tech-purple">ç³»ç»Ÿå¯åŠ¨ä¸­</span> <span class="text-gray-500">|</span> ç­‰å¾…åˆå§‹åŒ–å®Œæˆ...</div>
        </div>
      </div>
      
      <!-- æµ‹é€Ÿç»“æœè¡¨æ ¼ -->
      <div id="test-results">
        <h3 class="text-lg font-tech text-tech-light mb-3">ğŸ“Š æµ‹é€Ÿç»“æœ</h3>
        <div class="overflow-x-auto bg-tech-blue/30 rounded-lg border border-tech-accent/20 p-6 text-center">
          <p class="text-gray-400 italic">å°šæœªè¿›è¡Œæµ‹é€Ÿï¼Œè¯·ç‚¹å‡»"æ‰“å¼€ä¸‹è½½æ¨¡æ€æ¡†"æŒ‰é’®è·å–çº¿è·¯æ€§èƒ½æ•°æ®</p>
        </div>
      </div>
    </div>
    
    <!-- æœªæˆæƒæç¤º -->
    <div id="unauthorized-message" class="mb-8 p-6 rounded-lg bg-red-900/30 border border-red-500/50 hidden">
      <div class="flex items-start">
        <i class="fa fa-exclamation-triangle text-red-500 mr-4 text-2xl mt-1"></i>
        <div>
          <h3 class="text-xl font-bold text-red-400 mb-2">âŒ AIå¼•æ“è¯†åˆ«åˆ°æˆæƒé—®é¢˜</h3>
          <p class="text-red-300">é˜¿æ°æ²¡æœ‰æˆæƒä¸‹è½½æ–‡ä»¶æˆ–æˆæƒä¸‹è½½æ–‡ä»¶å·²è¿‡æœŸï¼Œè¯·è”ç³»é˜¿æ°è¿›è¡Œå¤„ç†ã€‚</p>
        </div>
      </div>
    </div>
    
    <!-- é¡µè„š -->
    <footer class="mt-12 text-center text-gray-500 text-sm">
      <p>Â© 2025 é˜¿æ°AIå¼•æ“é«˜é€Ÿæ™ºèƒ½ä¸‹è½½å™¨ | ç³»ç»ŸçŠ¶æ€: <span id="system-status" class="text-tech-accent">æ­£å¸¸è¿è¡Œä¸­</span></p>
    </footer>
  </div>

  <!-- æ›´æ–°æç¤ºæ¨¡æ€æ¡† -->
  <div id="updateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-tech-blue border border-tech-accent rounded-lg p-6 w-96">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-tech text-tech-light">æ–‡ä»¶æ›´æ–°æ£€æµ‹</h3>
        <button id="closeUpdateModal" class="text-gray-400 hover:text-white">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <p class="mb-6 text-gray-300">æ£€æµ‹åˆ°æ–‡ä»¶å·²æ›´æ–°ï¼Œå°†è‡ªåŠ¨å¼€å§‹ä¸‹è½½æ–°æ–‡ä»¶ã€‚</p>
      <div class="flex justify-end space-x-3">
        <button id="updateLater" class="px-4 py-2 border border-gray-600 rounded hover:bg-gray-700 transition-colors">
          å…³é—­
        </button>
        <button id="updateNow" class="px-4 py-2 bg-tech-accent text-white rounded hover:bg-cyan-500 transition-colors hidden">
          ç«‹å³æ›´æ–°
        </button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡† -->
  <div class="modal fade" id="downloadModal" tabindex="-1" role="dialog" aria-labelledby="downloadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content modern-modal bg-tech-blue border border-tech-accent">
        <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
        <div class="modal-header border-tech-accent/30">
          <h5 class="modal-title text-tech-light" id="downloadModalLabel">æ–‡ä»¶ä¸‹è½½</h5>
          <button type="button" class="close text-gray-400" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <!-- æ¨¡æ€æ¡†ä¸»ä½“ -->
        <div class="modal-body">
          <!-- ä¸‹è½½é“¾æ¥åŒºåŸŸ -->
          <div class="form-group mb-3">
            <!-- æ ‡é¢˜æ ‡ç­¾ -->
            <label class="form-label text-gray-300">
              <i class="fa fa-server mr-1 text-muted"></i>
              é€‰æ‹©é•œåƒ <!-- é€‰æ‹©é•œåƒ -->
            </label>
            <!-- ä¸‹è½½èŠ‚ç‚¹å®¹å™¨ -->
            <div class="d-flex flex-wrap gap-2" id="download-nodes-container">
              <!-- ç”µä¿¡èŠ‚ç‚¹ä¸‹è½½æŒ‰é’® -->
              <a class="btn btn-outline-primary flex-fill node-download-btn"
                 id="telcom_url"
                 data-node="telecom" 
                 target="_blank" 
                 href="javascript:void(0);">
                <div class="node-btn-content">
                  <div class="node-name">
                    <i class="fa fa-download mr-1"></i>ç”µä¿¡ä¸‹è½½ <!-- ç”µä¿¡ä¸‹è½½ -->
                  </div>
                  <div class="node-speed">
                    <span class="badge badge-info speed-badge">æµ‹é€Ÿä¸­...</span> <!-- é€Ÿåº¦æ ‡ç­¾ -->
                  </div>
                </div>
              </a>
              <!-- è”é€šèŠ‚ç‚¹ä¸‹è½½æŒ‰é’® -->
              <a class="btn btn-outline-primary flex-fill node-download-btn"
                 id="unicom_url"
                 data-node="unicom" 
                 target="_blank" 
                 href="javascript:void(0);">
                <div class="node-btn-content">
                  <div class="node-name">
                    <i class="fa fa-download mr-1"></i>è”é€šä¸‹è½½ <!-- è”é€šä¸‹è½½ -->
                  </div>
                  <div class="node-speed">
                    <span class="badge badge-info speed-badge">æµ‹é€Ÿä¸­...</span> <!-- é€Ÿåº¦æ ‡ç­¾ -->
                  </div>
                </div>
              </a>
              <!-- ç§»åŠ¨èŠ‚ç‚¹ä¸‹è½½æŒ‰é’® -->
              <a class="btn btn-outline-primary flex-fill node-download-btn"
                 id="cmnet_url"
                 data-node="cmnet" 
                 target="_blank"
                 href="javascript:void(0);">
                <div class="node-btn-content">
                  <div class="node-name">
                    <i class="fa fa-download mr-1"></i>ç§»åŠ¨ä¸‹è½½ <!-- ç§»åŠ¨ä¸‹è½½ -->
                  </div>
                  <div class="node-speed">
                    <span class="badge badge-info speed-badge">æµ‹é€Ÿä¸­...</span> <!-- é€Ÿåº¦æ ‡ç­¾ -->
                  </div>
                </div>
              </a>
              <!-- ç¾å›½è¥¿éƒ¨èŠ‚ç‚¹ä¸‹è½½æŒ‰é’® -->
              <a class="btn btn-outline-primary flex-fill node-download-btn"
                 id="usw_url"
                 data-node="usw" 
                 target="_blank" 
                 href="javascript:void(0);">
                <div class="node-btn-content">
                  <div class="node-name">
                    <i class="fa fa-download mr-1"></i>ç¾å›½è¥¿éƒ¨ä¸‹è½½ <!-- ç¾å›½è¥¿éƒ¨ä¸‹è½½ -->
                  </div>
                  <div class="node-speed">
                    <span class="badge badge-info speed-badge">æµ‹é€Ÿä¸­...</span> <!-- é€Ÿåº¦æ ‡ç­¾ -->
                  </div>
                </div>
              </a>
            </div>
          </div>
        </div>

        <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
        <div class="modal-footer border-tech-accent/30">
          <!-- æ‰‹åŠ¨è§¦å‘æµ‹é€ŸæŒ‰é’®ï¼ˆç”¨äºæµ‹è¯•ï¼‰-->
          <button type="button" id="testSpeedBtn" class="btn btn-secondary mr-2">
            <i class="fa fa-tachometer mr-1"></i>æ‰‹åŠ¨æµ‹é€Ÿ
          </button>
          <!-- ç¡®è®¤æŒ‰é’® -->
          <button type="button" data-dismiss="modal" class="btn btn-primary bg-tech-accent border-tech-accent">
            <i class="fa fa-check mr-1"></i>ç¡®è®¤ <!-- ç¡®è®¤ -->
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- å¼•å…¥jQuery -->
  <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
  
  <!-- å¼•å…¥Bootstrap JS -->
  <script src="https://cdn.staticfile.org/twitter-bootstrap/4.6.0/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆæ–°å¢åˆå§‹åŒ–å®Œæˆæ ‡è®°ï¼‰
    const appState = {
      isTesting: false,
      isDownloading: false,
      isInitialLoaded: false, // æ˜¯å¦å®Œæˆé¦–æ¬¡åˆå§‹åŒ–
      lastFileTime: null,     // ä¸Šæ¬¡æ–‡ä»¶æ—¶é—´æˆ³
      currentFileName: null,  // å½“å‰æ–‡ä»¶å
      downloadData: null,
      testResults: {},
      completedLines: 0,
      intervalId: null,
      lastUpdatePrompt: 0 // ä¸Šæ¬¡æç¤ºæ—¶é—´
    };
    
    // DOMå…ƒç´ å¼•ç”¨
    const elements = {
      statusInfo: document.getElementById('status-info'),
      authStatus: document.getElementById('auth-status'),
      authIcon: document.getElementById('auth-icon'),
      authMessage: document.getElementById('auth-message'),
      filename: document.getElementById('filename'),
      updateTime: document.getElementById('update-time'),
      speedTestSection: document.getElementById('speed-test-section'),
      terminalOutput: document.getElementById('terminal-output'),
      terminalLogs: document.getElementById('terminal-logs'),
      testResults: document.getElementById('test-results'),
      unauthorizedMessage: document.getElementById('unauthorized-message'),
      systemStatus: document.getElementById('system-status'),
      updateModal: document.getElementById('updateModal'), // æ·»åŠ æ›´æ–°æ¨¡æ€æ¡†å¼•ç”¨
      updateNow: document.getElementById('updateNow'),     // æ·»åŠ ç«‹å³æ›´æ–°æŒ‰é’®å¼•ç”¨
      updateLater: document.getElementById('updateLater'), // æ·»åŠ ç¨åæ›´æ–°æŒ‰é’®å¼•ç”¨
      closeUpdateModal: document.getElementById('closeUpdateModal') // æ·»åŠ å…³é—­æŒ‰é’®å¼•ç”¨
    };
    
    // çº¿è·¯ä¿¡æ¯æ˜ å°„
    const lineInfo = {
      telcom_url: { id: 'telcom', name: 'ç”µä¿¡çº¿è·¯', operator: 'ä¸­å›½ç”µä¿¡', icon: 'fa-signal' },
      unicom_url: { id: 'unicom', name: 'è”é€šçº¿è·¯', operator: 'ä¸­å›½è”é€š', icon: 'fa-signal' },
      cmnet_url: { id: 'cmnet', name: 'ç§»åŠ¨çº¿è·¯', operator: 'ä¸­å›½ç§»åŠ¨', icon: 'fa-signal' },
      usw_url: { id: 'usw', name: 'åŒ—ç¾çº¿è·¯', operator: 'å›½é™…å‡ºå£', icon: 'fa-globe' }
    };
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      document.body.classList.add('no-scroll');
      animateTitle();
      
      // ç»‘å®šæ›´æ–°æ¨¡æ€æ¡†äº‹ä»¶
      elements.updateNow.addEventListener('click', handleUpdateNow);
      elements.updateLater.addEventListener('click', handleUpdateLater);
      elements.closeUpdateModal.addEventListener('click', handleUpdateLater);
      
      // åˆå§‹è¯·æ±‚æ•°æ®ï¼ˆå¼ºåˆ¶ä¸ç¼“å­˜ï¼‰
      setTimeout(() => {
        logToTerminal('æ­£åœ¨è¿æ¥åˆ°æœåŠ¡å™¨...');
        fetchDownloadData(true); // é¦–æ¬¡åŠ è½½ï¼Œå¼ºåˆ¶åˆ·æ–°
      }, 1000);
      
      // ç»‘å®šäº‹ä»¶
    });
    
    // æ ‡é¢˜åŠ¨ç”»
    function animateTitle() {
      const title = document.getElementById('main-title');
      const chars = title.textContent.split('');
      title.textContent = '';
      
      chars.forEach((char, index) => {
        const span = document.createElement('span');
        span.textContent = char;
        span.style.opacity = '0';
        span.style.transform = 'translateY(20px)';
        span.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        title.appendChild(span);
        
        setTimeout(() => {
          span.style.opacity = '1';
          span.style.transform = 'translateY(0)';
        }, 50 * index);
      });
    }
    
    // ç»ˆç«¯æ—¥å¿—
    function logToTerminal(message, isError = false) {
      const now = new Date();
      const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
      
      const logEntry = document.createElement('div');
      logEntry.className = `animate-fade-in ${isError ? 'text-red-400' : ''}`;
      logEntry.innerHTML = `<span class="text-tech-purple">${timeStr}</span> <span class="text-gray-500">|</span> ${message}`;
      
      elements.terminalLogs.appendChild(logEntry);
      elements.terminalOutput.scrollTop = elements.terminalOutput.scrollHeight;
    }
    
    // è¯·æ±‚ä¸‹è½½æ•°æ®
    async function fetchDownloadData(forceRefresh = false) {
      try {
        updateStatus('æ­£åœ¨è·å–ä¸‹è½½ä¿¡æ¯...');
        const fetchOptions = {
          method: 'GET',
          cache: 'no-store',
          headers: { 
            'Cache-Control': 'no-cache, no-store, must-revalidate',
            'Pragma': 'no-cache',
            'Expires': '0'
          }
        };
        
        const response = await fetch('http://cdn.hlcssc.com/rjdz.json', fetchOptions);
        if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
        
        const data = await response.json();
        appState.downloadData = data;
        
        // å®‰å…¨åœ°å¤„ç†æ–‡ä»¶æ—¶é—´æˆ³
        const newFileTime = (data.time && typeof data.time === 'string') ? data.time.trim() : '';
        
        // é¦–æ¬¡åŠ è½½æˆ–å¼ºåˆ¶åˆ·æ–°ï¼ˆå®Œæˆåˆå§‹åŒ–ï¼‰
        if (forceRefresh) {
          // æ ‡è®°åˆå§‹åŒ–å®Œæˆï¼Œå¹¶è®°å½•æ–‡ä»¶æ—¶é—´æˆ³
          appState.isInitialLoaded = true;
          appState.lastFileTime = newFileTime || 'æœªçŸ¥æ—¶é—´';
          appState.currentFileName = data.filename || 'æœªçŸ¥æ–‡ä»¶';
          processDownloadData(data);
          startFileMonitoring(); // åˆå§‹åŒ–å®Œæˆåå¯åŠ¨æ–‡ä»¶ç›‘æ§
          logToTerminal(`åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰æ–‡ä»¶æ—¶é—´: ${appState.lastFileTime}`);
          // è°ƒè¯•ä¿¡æ¯ï¼šè®°å½•åˆå§‹åŒ–æ—¶çš„æ•°æ®
          logToTerminal(`åˆå§‹åŒ–æ•°æ®: filename='${data.filename}', time='${data.time}'`);
        } 
        // å·²å®Œæˆåˆå§‹åŒ–ï¼Œä¸”æ–‡ä»¶æ—¶é—´æˆ³å˜åŒ–ï¼ˆé¿å…æœªæ›´æ–°å´æç¤ºï¼‰
        else if (appState.isInitialLoaded && 
                 newFileTime && 
                 newFileTime.trim() !== '' && 
                 newFileTime !== 'æœªçŸ¥æ—¶é—´' &&
                 appState.lastFileTime && 
                 appState.lastFileTime.trim() !== '' && 
                 appState.lastFileTime !== 'æœªçŸ¥æ—¶é—´' &&
                 appState.lastFileTime.trim() !== newFileTime.trim()) { 
          // æ£€æŸ¥æ˜¯å¦åœ¨5ç§’å†…é‡å¤æç¤º
          if (Date.now() - appState.lastUpdatePrompt > 5000) {
            appState.lastUpdatePrompt = Date.now();
            appState.currentFileName = data.filename || 'æœªçŸ¥æ–‡ä»¶';
            appState.lastFileTime = newFileTime;
            showUpdateModal();
            logToTerminal(`æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ–°ï¼Œæ—¶é—´æˆ³å˜åŒ–: ${appState.lastFileTime} â†’ ${newFileTime}`);
            // ç«‹å³ä¸‹è½½æ–°æ–‡ä»¶
            $('#downloadModal').modal('show');
          } else {
            // è°ƒè¯•ä¿¡æ¯ï¼šè®°å½•è¢«å¿½ç•¥çš„æ›´æ–°æç¤º
            logToTerminal(`å¿½ç•¥é‡å¤æ›´æ–°æç¤ºï¼Œæ—¶é—´æˆ³: ${newFileTime}`);
          }
        }
        // è°ƒè¯•ä¿¡æ¯ï¼šè®°å½•JSONæ•°æ®
        else if (appState.isInitialLoaded) {
          logToTerminal(`JSONæ•°æ®: filename='${data.filename}', time='${data.time}'`);
        }

        
        return data;
      } catch (error) {
        console.error('è·å–ä¸‹è½½æ•°æ®å¤±è´¥:', error);
        updateStatus(`è·å–æ•°æ®å¤±è´¥: ${error.message}`, true);
        logToTerminal(`é”™è¯¯: è·å–ä¸‹è½½æ•°æ®å¤±è´¥ - ${error.message}`, true);
        document.body.classList.remove('no-scroll');
        return null;
      }
    }
    
    // å¤„ç†ä¸‹è½½æ•°æ®
    function processDownloadData(data) {
      document.body.classList.remove('no-scroll');
      
      // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
      elements.filename.textContent = data.filename || 'æœªçŸ¥æ–‡ä»¶';
      elements.updateTime.textContent = data.time || 'æœªçŸ¥æ—¶é—´';
      
      // éªŒè¯æˆæƒ
      const now = new Date();
      const updateTime = new Date(data.time);
      const timeDiff = (now - updateTime) / (1000 * 60 * 60); // å°æ—¶å·®
      
      if (timeDiff < 2) {
        elements.authIcon.className = 'fa fa-check-circle text-green-500 mr-3 text-xl';
        elements.authMessage.textContent = 'âœ… æˆæƒéªŒè¯æˆåŠŸ - æ‚¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ä¸‹è½½æœåŠ¡';
        elements.authStatus.classList.remove('hidden');
        elements.speedTestSection.classList.remove('hidden');
        elements.unauthorizedMessage.classList.add('hidden');
        updateStatus('æˆæƒéªŒè¯æˆåŠŸï¼Œç³»ç»Ÿå‡†å¤‡å°±ç»ª');
      } else {
        elements.authStatus.classList.add('hidden');
        elements.speedTestSection.classList.add('hidden');
        elements.unauthorizedMessage.classList.remove('hidden');
        updateStatus('æˆæƒå·²è¿‡æœŸï¼Œè¯·è”ç³»é˜¿æ°å¤„ç†');
        logToTerminal('é”™è¯¯: æˆæƒå·²è¿‡æœŸæˆ–æœªæˆæƒ', true);
      }
    }
    // æ›´æ–°çŠ¶æ€ä¿¡æ¯
    function updateStatus(message, isError = false) {
      elements.statusInfo.innerHTML = `<span class="${isError ? 'text-red-400' : ''}">${message}</span><span class="terminal-cursor">|</span>`;
    }
    
    // é€Ÿåº¦æµ‹è¯•é…ç½®
    const SPEED_TIMEOUT = 5000; // 5ç§’è¶…æ—¶æ—¶é—´

    // ä½¿ç”¨é¡µé¢çº§ç¼“å­˜ï¼ˆå­˜å‚¨åœ¨windowå¯¹è±¡ä¸Šï¼‰
    // ç»“æœåœ¨é¡µé¢åˆ·æ–°å‰ä¼šæŒç»­ä¿å­˜
    if (!window.nodeSpeedCache) {
      window.nodeSpeedCache = {
        results: {}, // æµ‹è¯•ç»“æœç¼“å­˜
        tested: false // æ˜¯å¦å·²æµ‹è¯•æ ‡è®°
      };
    }

    // æ ¹æ®å»¶è¿Ÿè·å–é€Ÿåº¦ç­‰çº§å’Œå¾½ç« ç±»å
    function getSpeedLevel(latency) {
      if (latency < 100) {
        return {
          text: 'ä¼˜ç§€', // æ˜¾ç¤ºæ–‡æœ¬
          badgeClass: 'badge-success' // å¾½ç« æ ·å¼ç±»
        };
      } else if (latency < 300) {
        return {
          text: 'è‰¯å¥½', // æ˜¾ç¤ºæ–‡æœ¬
          badgeClass: 'badge-primary' // å¾½ç« æ ·å¼ç±»
        };
      } else if (latency < 600) {
        return {
          text: 'ä¸€èˆ¬', // æ˜¾ç¤ºæ–‡æœ¬
          badgeClass: 'badge-warning' // å¾½ç« æ ·å¼ç±»
        };
      } else {
        return {
          text: 'æ…¢', // æ˜¾ç¤ºæ–‡æœ¬
          badgeClass: 'badge-secondary' // å¾½ç« æ ·å¼ç±»
        };
      }
    }

    // æ›´æ–°èŠ‚ç‚¹çš„é€Ÿåº¦å¾½ç« 
    function updateSpeedBadge(nodeBtn, speedData) {
      const speedBadge = nodeBtn.querySelector('.speed-badge');
      if (!speedBadge) return;

      // ç§»é™¤æµ‹é€Ÿä¸­çš„åŠ¨ç”»æ•ˆæœ
      speedBadge.classList.remove('badge-info', 'testing');

      // æ›´æ–°å¾½ç« æ ·å¼å’Œæ–‡æœ¬
      speedBadge.classList.add(speedData.badgeClass);
      speedBadge.textContent = speedData.text;

      // å¦‚æœæ˜¯æœ€å¿«çš„èŠ‚ç‚¹ï¼Œåˆ™æ·»åŠ æ¨èå¾½ç« 
      if (speedData.isRecommended) {
        const nodeSpeed = nodeBtn.querySelector('.node-speed');
        // ç§»é™¤å·²å­˜åœ¨çš„æ¨èå¾½ç« 
        const existingBadge = nodeSpeed.querySelector('.recommended-badge');
        if (existingBadge) {
          existingBadge.remove();
        }
        // æ·»åŠ æ–°çš„æ¨èå¾½ç« 
        const recommendedBadge = document.createElement('span');
        recommendedBadge.className = 'recommended-badge';
        recommendedBadge.innerHTML = '<i class="fa fa-star mr-1"></i>æ¨è';
        nodeSpeed.appendChild(recommendedBadge);
      }
    }

    // ä»ç¼“å­˜æ¢å¤ç»“æœåˆ°UIç•Œé¢
    function restoreCachedResults() {
      const nodeButtons = document.querySelectorAll('.node-download-btn');
      if (nodeButtons.length === 0 || !window.nodeSpeedCache.tested) return;

      const results = [];
      let fastestLatency = Infinity; // åˆå§‹åŒ–æœ€å¿«å»¶è¿Ÿä¸ºæ— ç©·å¤§

      // æ”¶é›†æ‰€æœ‰ç¼“å­˜çš„ç»“æœ
      nodeButtons.forEach(btn => {
        const nodeType = btn.getAttribute('data-node');
        const latency = window.nodeSpeedCache.results[nodeType];

        if (latency !== undefined) {
          results.push({ btn, nodeType, latency, success: latency !== Infinity });
          if (latency < fastestLatency && latency !== Infinity) {
            fastestLatency = latency;
          }
        }
      });

      // ä»ç¼“å­˜æ›´æ–°UI
      results.forEach(result => {
        if (!result.success) {
          // æµ‹è¯•å¤±è´¥çš„æƒ…å†µ
          updateSpeedBadge(result.btn, {
            text: '--',
            badgeClass: 'badge-secondary',
            isRecommended: false
          });
        } else {
          // æµ‹è¯•æˆåŠŸçš„æƒ…å†µ
          const speedLevel = getSpeedLevel(result.latency);
          speedLevel.isRecommended = (result.latency === fastestLatency);
          updateSpeedBadge(result.btn, speedLevel);
        }
      });
    }

    // æµ‹è¯•å•ä¸ªèŠ‚ç‚¹çš„é€Ÿåº¦
    async function testNodeSpeed(nodeBtn) {
      const nodeType = nodeBtn.getAttribute('data-node');
      const fullUrl = nodeBtn.getAttribute('href');

      if (!fullUrl) {
        return { latency: Infinity, success: false };
      }

      try {
        // ä»å®Œæ•´çš„ä¸‹è½½URLä¸­æå–ä¸»æœºåæ ¹URL
        const urlObj = new URL(fullUrl);
        const rootUrl = `${urlObj.protocol}//${urlObj.hostname}/`;

        const startTime = performance.now();

        // ä½¿ç”¨HEADè¯·æ±‚ä»…æµ‹è¯•æ ¹è·¯å¾„çš„é€Ÿåº¦
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), SPEED_TIMEOUT);

        const response = await fetch(rootUrl, {
          method: 'HEAD',
          mode: 'no-cors', // é¿å…CORSé—®é¢˜
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        const endTime = performance.now();
        const latency = Math.round(endTime - startTime); // è®¡ç®—å»¶è¿Ÿ

        // åœ¨no-corsæ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬æ— æ³•è®¿é—®å“åº”çš„è¯¦ç»†ä¿¡æ¯
        // ä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥æµ‹é‡è¯·æ±‚çš„å¾€è¿”æ—¶é—´
        return { latency, success: true };
      } catch (error) {
        console.warn(`èŠ‚ç‚¹ ${nodeType} æµ‹é€Ÿå¤±è´¥:`, error.message || error);
        // å³ä½¿åœ¨no-corsæ¨¡å¼ä¸‹ï¼ŒæŸäº›é”™è¯¯ä¹Ÿå¯èƒ½å‘ç”Ÿ
        // ä¾‹å¦‚ç½‘ç»œé”™è¯¯æˆ–è¶…æ—¶
        return { latency: Infinity, success: false };
      }
    }

    // æµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹
    async function testAllNodes() {
      // ä»JSONæ•°æ®ä¸­è·å–ä¸‹è½½é“¾æ¥
      updateDownloadLinksFromJSON();
      
      const nodeButtons = document.querySelectorAll('.node-download-btn');
      if (nodeButtons.length === 0) return;

      // æ˜¾ç¤ºæµ‹é€Ÿä¸­çš„åŠ¨ç”»æ•ˆæœ
      nodeButtons.forEach(btn => {
        const badge = btn.querySelector('.speed-badge');
        if (badge) {
          badge.classList.add('testing');
          badge.textContent = 'æµ‹é€Ÿä¸­...';
        }
      });

      // å¹¶è¡Œæµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹
      const results = await Promise.all(
        Array.from(nodeButtons).map(async btn => {
          const result = await testNodeSpeed(btn);
          return { btn, ...result };
        })
      );

      // æŸ¥æ‰¾æœ€å¿«çš„èŠ‚ç‚¹
      let fastestLatency = Infinity;
      results.forEach(result => {
        if (result.success && result.latency < fastestLatency) {
          fastestLatency = result.latency;
        }
      });

      // æ›´æ–°æ‰€æœ‰å¾½ç« å¹¶ç¼“å­˜ç»“æœ
      results.forEach(result => {
        const nodeType = result.btn.getAttribute('data-node');

        if (!result.success) {
          // æµ‹è¯•å¤±è´¥æˆ–è¶…æ—¶
          updateSpeedBadge(result.btn, {
            text: '--',
            badgeClass: 'badge-secondary',
            isRecommended: false
          });
          window.nodeSpeedCache.results[nodeType] = Infinity;
        } else {
          // æµ‹è¯•æˆåŠŸ
          const speedLevel = getSpeedLevel(result.latency);
          speedLevel.isRecommended = (result.latency === fastestLatency && fastestLatency < Infinity);
          updateSpeedBadge(result.btn, speedLevel);
          window.nodeSpeedCache.results[nodeType] = result.latency;
        }
      });

      // æ ‡è®°ä¸ºå·²æµ‹è¯•
      window.nodeSpeedCache.tested = true;
      
      // æ˜¾ç¤ºæµ‹é€Ÿç»“æœ
      displayTestResults();
    }

    // ä»JSONæ•°æ®æ›´æ–°ä¸‹è½½é“¾æ¥
    function updateDownloadLinksFromJSON() {
      if (!appState.downloadData) {
        console.warn('ä¸‹è½½æ•°æ®æœªå‡†å¤‡å¥½');
        return;
      }
      
      // æ˜ å°„JSONé”®ååˆ°èŠ‚ç‚¹ID
      const nodeMap = {
        'telcom_url': 'telcom_url',
        'unicom_url': 'unicom_url',
        'cmnet_url': 'cmnet_url',
        'usw_url': 'usw_url'
      };
      
      // æ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹è½½é“¾æ¥
      Object.entries(nodeMap).forEach(([jsonKey, nodeId]) => {
        if (appState.downloadData[jsonKey]) {
          const nodeElement = document.getElementById(nodeId);
          if (nodeElement) {
            nodeElement.setAttribute('href', appState.downloadData[jsonKey]);
            console.log(`æ›´æ–°èŠ‚ç‚¹ ${nodeId} çš„ä¸‹è½½é“¾æ¥: ${appState.downloadData[jsonKey]}`);
          } else {
            console.warn(`æœªæ‰¾åˆ°èŠ‚ç‚¹å…ƒç´ : ${nodeId}`);
          }
        } else {
          console.warn(`JSONæ•°æ®ä¸­æœªæ‰¾åˆ°é”®: ${jsonKey}`);
        }
      });
    }

    // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
    function displayTestResults() {
      const nodeButtons = document.querySelectorAll('.node-download-btn');
      if (nodeButtons.length === 0) return;

      // æ¸…ç©ºç°æœ‰çš„ç»“æœ
      const resultsContainer = document.createElement('div');
      resultsContainer.className = "overflow-x-auto";
      resultsContainer.innerHTML = `
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-tech-blue/50 border-b border-tech-accent/30">
              <th class="p-3 text-left">çº¿è·¯æ ‡è¯†</th>
              <th class="p-3 text-left">æµ‹è¯•ç»“æœ</th>
              <th class="p-3 text-left">çŠ¶æ€</th>
            </tr>
          </thead>
          <tbody id="results-body"></tbody>
        </table>
      `;

      elements.testResults.innerHTML = `<h3 class="text-lg font-tech text-tech-light mb-3">ğŸ“Š æµ‹é€Ÿç»“æœ</h3>`;
      elements.testResults.appendChild(resultsContainer);

      const resultsBody = resultsContainer.querySelector('#results-body');
      
      // è·å–æµ‹é€Ÿç»“æœå¹¶æ’åº
      const results = [];
      nodeButtons.forEach(btn => {
        const nodeType = btn.getAttribute('data-node');
        const nodeName = btn.querySelector('.node-name').textContent;
        const latency = window.nodeSpeedCache.results[nodeType];
        
        results.push({
          nodeType,
          nodeName,
          latency,
          success: latency !== undefined && latency !== Infinity
        });
      });
      
      // æŒ‰å»¶è¿Ÿæ’åº
      results.sort((a, b) => {
        if (!a.success) return 1;
        if (!b.success) return -1;
        return a.latency - b.latency;
      });
      
      // æ˜¾ç¤ºç»“æœ
      results.forEach((result, index) => {
        const row = document.createElement('tr');
        row.className = `border-b border-tech-accent/10 hover:bg-tech-blue/20 transition-colors ${index === 0 && result.success ? 'bg-green-900/20' : ''}`;
        
        if (result.success) {
          const speedLevel = getSpeedLevel(result.latency);
          row.innerHTML = `
            <td class="p-3">${result.nodeName}</td>
            <td class="p-3 font-mono ${index === 0 ? 'text-green-400 font-bold' : ''}">${result.latency}ms</td>
            <td class="p-3"><span class="speed-badge ${speedLevel.badgeClass}">${speedLevel.text}</span> ${index === 0 ? '<span class="recommended-badge"><i class="fa fa-star mr-1"></i>æ¨è</span>' : ''}</td>
          `;
        } else {
          row.innerHTML = `
            <td class="p-3">${result.nodeName}</td>
            <td class="p-3 font-mono">--</td>
            <td class="p-3"><span class="speed-badge badge-secondary">æµ‹é€Ÿå¤±è´¥</span></td>
          `;
        }
        
        resultsBody.appendChild(row);
      });
    }

    // å½“æ¨¡æ€æ¡†æ˜¾ç¤ºæ—¶å¼€å§‹é€Ÿåº¦æµ‹è¯•
    $(document).on('shown.bs.modal', function(e) {
      console.log('æ¨¡æ€æ¡†æ˜¾ç¤ºäº‹ä»¶è§¦å‘');
      // æ£€æŸ¥æ­¤æ¨¡æ€æ¡†æ˜¯å¦åŒ…å«ä¸‹è½½èŠ‚ç‚¹
      const nodeButtons = $(e.target).find('.node-download-btn');
      console.log('æ‰¾åˆ°çš„èŠ‚ç‚¹æŒ‰é’®æ•°é‡:', nodeButtons.length);
      
      if (nodeButtons.length > 0) {
        console.log('ç¼“å­˜æµ‹è¯•çŠ¶æ€:', window.nodeSpeedCache.tested);
        // ä»JSONæ•°æ®æ›´æ–°ä¸‹è½½é“¾æ¥
        updateDownloadLinksFromJSON();
        
        if (!window.nodeSpeedCache.tested) {
          // é¦–æ¬¡æµ‹è¯• - è¿è¡Œé€Ÿåº¦æµ‹è¯•
          console.log('å¼€å§‹é¦–æ¬¡æµ‹é€Ÿ');
          logToTerminal('å¼€å§‹å¤šçº¿è·¯å¹¶è¡Œæµ‹é€Ÿ');
          testAllNodes().catch(error => {
            console.error('æµ‹é€Ÿè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
            logToTerminal(`æµ‹é€Ÿè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${error.message}`, true);
          });
        } else {
          // å·²æµ‹è¯•è¿‡ - ä»ç¼“å­˜æ¢å¤
          console.log('ä»ç¼“å­˜æ¢å¤æµ‹é€Ÿç»“æœ');
          logToTerminal('ä»ç¼“å­˜æ¢å¤æµ‹é€Ÿç»“æœ');
          restoreCachedResults();
          displayTestResults();
        }
      } else {
        console.log('æœªæ‰¾åˆ°èŠ‚ç‚¹æŒ‰é’®');
      }
    });
    
    // é¡µé¢åŠ è½½å®Œæˆåæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡æµ‹é€Ÿï¼ˆç”¨äºè°ƒè¯•ï¼‰
    $(document).ready(function() {
      console.log('é¡µé¢åŠ è½½å®Œæˆ');
      
      // æ‰‹åŠ¨æµ‹é€ŸæŒ‰é’®äº‹ä»¶å¤„ç†
      $('#testSpeedBtn').on('click', function() {
        console.log('æ‰‹åŠ¨è§¦å‘æµ‹é€Ÿ');
        logToTerminal('æ‰‹åŠ¨è§¦å‘æµ‹é€Ÿ');
        // é‡ç½®ç¼“å­˜çŠ¶æ€ä»¥å¼ºåˆ¶é‡æ–°æµ‹é€Ÿ
        window.nodeSpeedCache.tested = false;
        // ä»JSONæ•°æ®æ›´æ–°ä¸‹è½½é“¾æ¥
        updateDownloadLinksFromJSON();
        testAllNodes().catch(error => {
          console.error('æµ‹é€Ÿè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
          logToTerminal(`æµ‹é€Ÿè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${error.message}`, true);
        });
      });
    });

    // å¯åŠ¨æ–‡ä»¶ç›‘æ§ï¼ˆä»…åˆå§‹åŒ–å®Œæˆåï¼‰
    function startFileMonitoring() {
      if (appState.intervalId) clearInterval(appState.intervalId);
      
      // æ¯4ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œä¸”åªåœ¨ç©ºé—²çŠ¶æ€
      appState.intervalId = setInterval(async () => {
        if (!appState.isTesting && !appState.isDownloading && appState.isInitialLoaded) {
          elements.systemStatus.textContent = 'æ­£åœ¨æ£€æŸ¥æ›´æ–°...';
          await fetchDownloadData(); // éå¼ºåˆ¶åˆ·æ–°ï¼Œä»…æ£€æŸ¥å˜åŒ–
          elements.systemStatus.textContent = 'æ­£å¸¸è¿è¡Œä¸­';
        }
      }, 4000);
    }
    
    // æ˜¾ç¤ºæ›´æ–°æç¤ºï¼ˆä»…åœ¨çœŸæ­£æ›´æ–°æ—¶ï¼‰
    function showUpdateModal() {
      elements.updateModal.classList.remove('hidden');
    }
    
    // ç«‹å³æ›´æ–°
    function handleUpdateNow() {
      elements.updateModal.classList.add('hidden');
      // ç›´æ¥æ˜¾ç¤ºä¸‹è½½æ¨¡æ€æ¡†
      $('#downloadModal').modal('show');
    }
    
    // ç¨åæ›´æ–°
    function handleUpdateLater() {
      elements.updateModal.classList.add('hidden');
    }
    
  </script>
</body>
</html>
